$('.image-upload').on('upload.ir', function(e, d) {
    var inputParent = this;
    console.log(inputParent);
    //var files = inputParent.children[0].files;
    var files = d.files;
    console.log(files.length);
    if (files.length == 0) {
      return 0;
    }
    var file = files[0];
    var accepted_image_extensions = ["svg", "png", "jpg", "jpeg", "gif"];
    var extension = file.name.split('.')[1];
    if (!accepted_image_extensions.includes(extension)) {
      return 0;
    }
    var spanElement = inputParent.nextElementSibling;
    spanElement.innerHTML = ''
    var reader = new FileReader();
    reader.onload = (function (theFile) {
      return function (e) {
        spanElement.innerHTML = ['<img style="max-width: 500px; max-height: 500px" class="img-fluid" src="', e.target.result,
                          '" title="', escape(theFile.name), '"/>'].join('');
      }
    })(file);
    reader.readAsDataURL(file);
});

$('.image-upload').on('uploaded.ir', function(e, d) {
  var $o = $(this), $feedback = $o.next('.feedback');

  var argument_name = $(this).data('name'),
      target_id = argument_name, $target = $('#' + target_id);

  $.post(CC.image.import_url, {
    upload_id: d.upload_id,
    argument_name: argument_name
  }).fail(function(x) {
    $feedback.html(x.responseJSON[argument_name]);
  }).success(function(x) {
    $target.html(x);
    $('[name=' + target_id + ']').val(d.upload_id);
    $feedback.text('');
  });

});
